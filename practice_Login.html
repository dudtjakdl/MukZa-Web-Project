<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>MainLogin</title>

    <!-- 1. 카카오SDK로드 -->
    <script src="https://developers.kakao.com/sdk/js/kakao.js"></script>
    <link
      rel="shortcut icon"
      href="../images/fav_icon.png"
      type="image/x-icon"
    />
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700"
      rel="stylesheet"
    />
    <!-- Bulma Version 0.9.0-->
    <link
      rel="stylesheet"
      href="https://unpkg.com/bulma@0.9.0/css/bulma.min.css"
    />
  </head>

  <body>
    <section
      class="hero is-success is-fullheight"
      style="
        background: url(static/img/login_main.png) no-repeat 0 0;
        background-size: 100% 100%;
      "
    >
      <div class="hero-head">
        <nav class="navbar">
          <div class="container">
            <div class="navbar-brand">
              <a class="navbar-item" onclick="window.location.reload();">
                <img src="./img/logo.png" alt="Logo" />
              </a>
              <span class="navbar-burger burger" data-target="navbarMenu">
                <span></span>
                <span></span>
                <span></span>
              </span>
            </div>
            <div id="navbarMenu" class="navbar-menu">
              <div class="navbar-end">
                <span class="navbar-item">
                  <a class="button is-white is-outlined" href="#">
                    <span class="icon">
                      <i class="fa fa-home"></i>
                    </span>
                    <span>Home</span>
                  </a>
                </span>
                <span class="navbar-item">
                  <a class="button is-white is-outlined" href="#">
                    <span class="icon">
                      <i class="fa fa-superpowers"></i>
                    </span>
                    <span>Examples</span>
                  </a>
                </span>
                <span class="navbar-item">
                  <a class="button is-white is-outlined" href="#">
                    <span class="icon">
                      <i class="fa fa-book"></i>
                    </span>
                    <span>Documentation</span>
                  </a>
                </span>
                <span class="navbar-item">
                  <a
                    class="button is-white is-outlined"
                    href="https://github.com/BulmaTemplates/bulma-templates/blob/master/templates/landing.html"
                  >
                    <span class="icon">
                      <i class="fa fa-github"></i>
                    </span>
                    <span>View Source</span>
                  </a>
                </span>
              </div>
            </div>
          </div>
        </nav>
      </div>

      <div class="hero-body">
        <div class="container has-text-centered">
          <div class="column is-6 is-offset-3">
            <h1 class="title">MukZa</h1>
            <h2 class="subtitle">
              $this is the best software platform for running an internet
              business. We handle billions of dollars every year for
              forward-thinking businesses around the world.
            </h2>
            <!-- <div class="box"> -->
            <div style="text-align: center">
              <a id="custom-login-btn" href="javascript:loginWithKakao()">
                <img
                  src="//k.kakaocdn.net/14/dn/btqCn0WEmI3/nijroPfbpCa4at5EIsjyf0/o.jpg"
                  width="222"
                />
              </a>
              <!-- <button class="api-btn" onclick="kakaoLogout()">로그아웃</button>

              <a id="kakao-login-btn"></a>
              <button class="api-btn" onclick="unlinkApp()">앱 탈퇴하기</button> -->
              <div id="result"></div>
              <script type="text/javascript">
                function unlinkApp() {
                  Kakao.API.request({
                    url: "/v1/user/unlink",
                    success: function (res) {
                      alert("success: " + JSON.stringify(res));
                    },
                    fail: function (err) {
                      alert("fail: " + JSON.stringify(err));
                    },
                  });
                }
              </script>
              <script type="text/javascript">
                // 2. 카카오 초기화
                Kakao.init("4f4010efb825591322d7532cb417a79b");

                console.log(Kakao.isInitialized()); // 초기화 판단여부

                // 3. 데모버전으로 들어가서 카카오로그인 코드를 확인.
                function loginWithKakao() {
                  Kakao.Auth.login({
                    scope:
                      "profile_nickname, account_email, gender, friends, talk_message, profile_image",
                    success: function (authObj) {
                      console.log(authObj); // access토큰 값
                      Kakao.Auth.setAccessToken(authObj.access_token); // access토큰값 저장

                      getInfo();
                    },
                    fail: function (err) {
                      console.log(err);
                    },
                  });
                }

                // 4. 엑세스 토큰을 발급받고, 아래 함수를 호출시켜서 사용자 정보를 받아옴.
                function getInfo() {
                  Kakao.API.request({
                    url: "/v2/user/me",
                    success: function (res) {
                      console.log(res);
                      // 이메일, 성별, 닉네임, 프로필이미지
                      var email = res.kakao_account.email;
                      var gender = res.kakao_account.gender;
                      var nickname = res.kakao_account.profile.nickname;
                      var profile_image =
                        res.kakao_account.profile.thumbnail_image_url;

                      console.log(email, gender, nickname, profile_image);

                      let email_print = document.getElementById("print_email");
                      email_print.innerText = email;
                    },
                    fail: function (error) {
                      alert(
                        "카카오 로그인에 실패했습니다. 관리자에게 문의하세요." +
                          JSON.stringify(error)
                      );
                    },
                  });
                }

                // 5. 로그아웃 기능 - 카카오 서버에 접속하는 엑세스 토큰을 만료, 사용자 어플리케이션의 로그아웃은 따로 진행.
                function kakaoLogout() {
                  if (!Kakao.Auth.getAccessToken()) {
                    alert("Not logged in.");
                    return;
                  }
                  Kakao.Auth.logout(function () {
                    alert(
                      "logout ok\naccess token -> " +
                        Kakao.Auth.getAccessToken()
                    );
                    let email_print = document.getElementById("print_email");
                    email_print.innerText = "";
                  });
                }
              </script>
              <div id="print_email"></div>
              <!-- </div> -->
            </div>
            <p class="has-text-grey">
              <a onclick="kakaoLogout()">Logout</a> &nbsp;·&nbsp;
              <a onclick="unlinkApp()">탈퇴하기</a> &nbsp;·&nbsp;
              <a href="../">Need Help?</a>
            </p>
          </div>
        </div>
      </div>
      <footer>
        <p>Copyright © 2021 KWANGWOON UNIVERSITY MUKZA. All rights reserved.</p>
        <address>Contact webmaster for more information. 070-1234-5678</address>
      </footer>
    </section>

  </body>
</html>
